<!--
@author Francisco Miguel Aramburo Torres - atfm05@gmail.com
-->

<link rel="import" href="../../components/polymer/polymer.html">
<link rel="import" href="../../components/iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="../../components/iron-media-query/iron-media-query.html">
<link rel="import" href="../../components/iron-ajax/iron-ajax.html">

<link rel="import" href="../../components/paper-card/paper-card.html">

<link rel="import" href="../../components/paper-styles/color.html">
<link rel="import" href="../../pl-utils/arckane-styles.html">

<link rel="import" href="./edit-date.html">
<link rel="import" href="./edit-pricing.html">
<link rel="import" href="./edit-location.html">

<dom-module id="edit-session">
  <style>
    * {
      box-sizing: border-box;
    }

    :host {
      display: block;
      @apply(--layout-flex);
      @apply(--layout-vertical);
      @apply(--layout-center);
      --default-primary-color: var(--arckane-aqua-100);
      --paper-slider-height: 3px;
      --paper-slider-knob-color: var(--arckane-purple-200);
      --paper-slider-active-color: var(--arckane-purple-200);
      --paper-slider-pin-color: var(--arckane-aqua-100);
    }

    .desktop-container {
      width: 1000px;
    }
  </style>

  <template>
    <iron-media-query query="(min-width: 900px)" query-matches="{{isDesktopSize}}"></iron-media-query>

    <iron-ajax
      id="ajax"
      method="GET"
      on-response="_dataResponse"
      last-response="{{data}}"
      handle-as="json">
    </iron-ajax>

    <iron-ajax id="updateSessionRequest"></iron-ajax>

    <template is="dom-if" if="{{isDesktopSize}}">
      <div class="desktop-container layout vertical flex">
        <div class="horizontal layout" style="width:100%;">
          <!-- Date, time and length card -->
          <edit-date style="margin-bottom:10px; margin-right:10px;" class="flex" id="editDate" session-id="[[sessionId]]"></edit-date>
          <!-- Topics and skills -->
          <!-- Pricing and maximum apprentices -->
          <edit-pricing style="margin-bottom:10px;" class="flex" id="editPricing" session-id="[[sessionId]]"></edit-pricing>
        </div>
        <!-- Location -->
        <edit-location style="width:100%; margin-bottom:10px;" class="flex" id="editLocation" session-id="[[sessionId]]"></edit-location>
      </div>
    </template>

    <template is="dom-if" if="{{!isDesktopSize}}">
      <!-- Date, time and length card -->
      <edit-date style="width:100%; margin-bottom:10px;" id="editDate" session-id="[[sessionId]]"></edit-date>
      <!-- Topics and skills -->
      <!-- Pricing and maximum apprentices -->
      <edit-pricing style="width:100%; margin-bottom:10px;" id="editPricing" session-id="[[sessionId]]"></edit-pricing>
      <!-- Location -->
      <edit-location style="width:100%; margin-bottom:10px;" id="editLocation" session-id="[[sessionId]]"></edit-location>
    </template>
  </template>
</dom-module>

<script>
  Polymer({

    is: "edit-session",

    properties: {
      sessionId: String
    },

    _dataResponse: function () {
      this.$$("#editDate").ajaxRequester = this.$.updateSessionRequest;
      this.$$("#editPricing").ajaxRequester = this.$.updateSessionRequest;
      this.$$("#editLocation").ajaxRequester = this.$.updateSessionRequest;

      this.$$("#editDate").safetyFlag = false;
      this.$$("#editPricing").safetyFlag = false;
      this.$$("#editLocation").safetyFlag = false;

      this.$$("#editDate").setInitialData(this.data);
      this.$$("#editPricing").setInitialData(this.data);
      this.$$("#editLocation").setInitialData(this.data);

      this.async(function () {
        this.$$("#editDate").safetyFlag = true;
        this.$$("#editPricing").safetyFlag = true;
        this.$$("#editLocation").safetyFlag = true;
      }, 500)
    },

    ready: function () {
      this.$.ajax.url = "/api/schedules/editdata/session/"+this.sessionId
      this.$.ajax.generateRequest();
    }
  });
</script>
