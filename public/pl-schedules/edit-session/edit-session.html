<!--
@author Francisco Miguel Aramburo Torres - atfm05@gmail.com
-->

<link rel="import" href="../../components/polymer/polymer.html">
<link rel="import" href="../../components/iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="../../components/iron-media-query/iron-media-query.html">
<link rel="import" href="../../components/iron-ajax/iron-ajax.html">

<link rel="import" href="../../components/paper-card/paper-card.html">

<link rel="import" href="../../components/paper-styles/color.html">
<link rel="import" href="../../pl-utils/arckane-styles.html">

<link rel="import" href="./edit-date.html">
<link rel="import" href="./edit-pricing.html">
<link rel="import" href="./edit-location.html">

<dom-module id="edit-session">
  <style>
    * {
      box-sizing: border-box;
    }

    :host {
      @apply(--layout-horizontal);
      @apply(--layout-wrap);
      --default-primary-color: var(--arckane-aqua-100);
      --paper-slider-height: 3px;
      --paper-slider-knob-color: var(--arckane-purple-200);
      --paper-slider-active-color: var(--arckane-purple-200);
      --paper-slider-pin-color: var(--arckane-aqua-100);
    }
  </style>

  <template>
    <iron-media-query query="(min-width: 900px)" query-matches="{{isDesktopSize}}"></iron-media-query>

    <iron-ajax
      id="ajax"
      method="GET"
      on-response="_dataResponse"
      last-response="{{data}}"
      handle-as="json">
    </iron-ajax>

    <iron-ajax id="updateSessionRequest"></iron-ajax>

    <!-- Date, time and length card -->
    <edit-date style="width:100%; margin-bottom:10px;" id="editDate" session-id="[[sessionId]]"></edit-date>
    <!-- Topics and skills -->
    <!-- Pricing and maximum apprentices -->
    <edit-pricing style="width:100%; margin-bottom:10px;" id="editPricing" session-id="[[sessionId]]"></edit-pricing>
    <!-- Location -->
    <edit-location style="width:100%; margin-bottom:10px;" id="editLocation" session-id="[[sessionId]]"></edit-location>

  </template>
</dom-module>

<script>
  Polymer({

    is: "edit-session",

    properties: {
      sessionId: String
    },

    _dataResponse: function () {
      this.$.editDate.safetyFlag = false;
      this.$.editPricing.safetyFlag = false;
      this.$.editLocation.safetyFlag = false;

      this.$.editDate.setInitialData(this.data);
      this.$.editPricing.setInitialData(this.data);
      this.$.editLocation.setInitialData(this.data);

      this.async(function () {
        this.$.editDate.safetyFlag = true;
        this.$.editPricing.safetyFlag = true;
        this.$.editLocation.safetyFlag = true;
      }, 500)
    },

    ready: function () {
      this.$.editDate.ajaxRequester = this.$.updateSessionRequest;
      this.$.editPricing.ajaxRequester = this.$.updateSessionRequest;
      this.$.editLocation.ajaxRequester = this.$.updateSessionRequest;

      this.$.ajax.url = "/api/schedules/editdata/session/"+this.sessionId
      this.$.ajax.generateRequest();
    }
  });
</script>
